<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محراب النور العظيم - النسخة الإمبراطورية المدمجة</title>
    
    <style>
        /* [1] إعدادات الخطوط العالمية */
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Reem+Kufi:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap');

        :root {
            --gold-primary: #d4af37;
            --gold-secondary: #f1c40f;
            --deep-void: #020a02;
            --emerald-shadow: #041604;
            --glow-strength: 0 0 50px rgba(212, 175, 55, 0.5);
            --transition-speed: 2.5s;
        }

        /* [2] تصفير الإعدادات الأساسية */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--deep-void);
            font-family: 'Amiri', serif;
            color: #fff;
            cursor: none; /* إخفاء الماوس لإضافة لمسة سينمائية */
        }

        /* [3] طبقات الخلفية والأنيميشن */
        #master-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -10; pointer-events: none;
        }

        .background-shroud {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 0%, var(--deep-void) 90%);
            z-index: -5;
        }

        .spiritual-vision-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://images.unsplash.com/photo-1590076215667-873d3148f029?q=80&w=2070&auto=format&fit=crop') center/cover;
            opacity: 0;
            mix-blend-mode: overlay;
            filter: sepia(1) brightness(0.1) contrast(1.3);
            animation: cinematicPulse 150s infinite ease-in-out;
            z-index: -8;
        }

        @keyframes cinematicPulse {
            0%, 100% { opacity: 0; transform: scale(1.0); filter: blur(8px); }
            50% { opacity: 0.2; transform: scale(1.2); filter: blur(0px); }
        }

        /* [4] نظام الساعة الملكي */
        .royal-time-module {
            position: fixed; top: 60px; right: 80px;
            text-align: right; z-index: 100;
            font-family: 'Reem Kufi', sans-serif;
            pointer-events: none;
        }

        #time-digits {
            font-size: 4rem;
            color: var(--gold-primary);
            text-shadow: var(--glow-strength);
            letter-spacing: 8px;
            font-weight: 300;
            line-height: 1;
        }

        #time-label {
            font-size: 0.8rem;
            color: var(--gold-secondary);
            text-transform: uppercase;
            opacity: 0.6;
            margin-top: 5px;
            letter-spacing: 3px;
        }

        /* [5] واجهة التحكم (القراء والسور) */
        .royal-interface {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            display: flex;
            gap: 20px;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px 30px;
            border-radius: 50px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: 0.5s ease;
        }

        .royal-interface:hover {
            border-color: var(--gold-primary);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.1);
        }

        .royal-select {
            background: transparent;
            color: var(--gold-primary);
            border: none;
            font-family: 'Amiri', serif;
            font-size: 1.1rem;
            outline: none;
            cursor: pointer;
            padding: 5px 10px;
        }

        .royal-select option {
            background: #0a0a0a;
            color: var(--gold-primary);
        }

        /* [6] المحراب المركزي وعرض الآيات */
        .miracle-shrine {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            position: relative;
            z-index: 50;
        }

        .ayah-frame {
            position: relative;
            padding: 80px;
            width: 90%;
            max-width: 1100px;
            text-align: center;
        }

        .decoration-line {
            width: 400px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-primary), transparent);
            margin: 50px auto;
            opacity: 0.4;
            box-shadow: 0 0 15px var(--gold-primary);
        }

        #ayah-content {
            font-size: clamp(28px, 5vw, 60px);
            color: var(--gold-primary);
            line-height: 1.8;
            font-weight: 400;
            text-shadow: 0 0 40px rgba(212, 175, 55, 0.5);
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 3s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 3.5s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Scheherazade New', serif;
        }

        #ayah-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* [7] الكلمات الطائرة (الذكر العائم) */
        .flying-scripture {
            position: absolute;
            color: rgba(212, 175, 55, 0.04);
            font-size: 3rem;
            pointer-events: none;
            white-space: nowrap;
            z-index: -2;
            will-change: transform;
        }

        /* [8] مشغل الصوت المخفي */
        #audio-player { display: none; }

        /* [9] مؤشر الماوس المخصص */
        #custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 1px solid var(--gold-primary);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
        }
    </style>
</head>
<body>

    <div id="custom-cursor"></div>
    <canvas id="master-canvas"></canvas>
    <div class="background-shroud"></div>
    <div class="spiritual-vision-layer"></div>
    <div id="flying-container"></div>

    <div class="royal-time-module">
        <div id="time-digits">00:00:00</div>
        <div id="time-label">توقيت محراب النور</div>
    </div>

    <div class="royal-interface">
        <select id="reciter-dropdown" class="royal-select" onchange="changeSource()">
            <optgroup label="تونس - مدرسة القراءات">
                <option value="https://server6.mp3quran.net/tunsi/">الشيخ علي البراق</option>
                <option value="https://server12.mp3quran.net/maher/">الشيخ محمد المشفر</option>
                <option value="https://server10.mp3quran.net/qtm/">الشيخ أنيس المسلماني</option>
                <option value="https://server9.mp3quran.net/hadi/">الشيخ الهادي فخفخ</option>
            </optgroup>
            <optgroup label="السعودية - أصوات الحرمين">
                <option value="https://server8.mp3quran.net/lhdan/">محمد اللحيدان ⭐</option>
                <option value="https://server12.mp3quran.net/maher/">ماهر المعيقلي</option>
                <option value="https://server11.mp3quran.net/yasser/">ياسر الدوسري</option>
                <option value="https://server7.mp3quran.net/sds/">عبدالرحمن السديس</option>
                <option value="https://server6.mp3quran.net/shur/">سعود الشريم</option>
                <option value="https://server10.mp3quran.net/nasser/">ناصر القطامي</option>
                <option value="https://server13.mp3quran.net/hazza/">هزاع البلوشي</option>
            </optgroup>
            <optgroup label="مصر - العمالقة">
                <option value="https://server11.mp3quran.net/minsh/">المنشاوي (مرتل)</option>
                <option value="https://server9.mp3quran.net/basit/">عبدالباسط (مرتل)</option>
                <option value="https://server8.mp3quran.net/hussary/">الحصري</option>
                <option value="https://server12.mp3quran.net/mustafa/">مصطفى إسماعيل</option>
            </optgroup>
            <optgroup label="الكويت والإمارات">
                <option value="https://server8.mp3quran.net/afs/">مشاري العفاسي</option>
                <option value="https://server15.mp3quran.net/thubti/">أحمد النفيس</option>
                <option value="https://server11.mp3quran.net/qht/">خالد القحطاني</option>
            </optgroup>
            </select>

        <select id="surah-dropdown" class="royal-select" onchange="changeSource()">
            </select>
    </div>

    <main class="miracle-shrine">
        <div class="ayah-frame">
            <div class="decoration-line"></div>
            <h2 id="ayah-content">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ</h2>
            <div class="decoration-line"></div>
        </div>
    </main>

    <audio id="audio-player"></audio>

    <script>
        /**
         * [محرك التطبيق الشامل]
         * يحتوي على: نظام الجسيمات، نظام المزامنة، نظام جلب البيانات
         */

        const CONFIG = {
            particleDensity: 200,
            floatingInterval: 8000,
            colors: ['#d4af37', '#f1c40f', '#b8860b', '#eee8aa'],
            phrases: ["سُبْحَانَ اللَّهِ", "لَا إِلَهَ إِلَّا اللَّهُ", "اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ", "الْحَمْدُ لِلَّهِ", "اللَّهُ أَكْبَرُ", "أستغفر الله"]
        };

        const state = {
            ayahs: [],
            currentAyahIndex: -1,
            mouse: { x: -100, y: -100 },
            isLoaded: false
        };

        // --- محرك الرسوميات (Canvas Engine) ---
        const canvas = document.getElementById('master-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        class Particle {
            constructor() {
                this.init();
            }
            init() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 0.2;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = -Math.random() * 0.8 - 0.2;
                this.color = CONFIG.colors[Math.floor(Math.random() * CONFIG.colors.length)];
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.opacity;
                ctx.fill();
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                // تفاعل مع الماوس
                let dx = state.mouse.x - this.x;
                let dy = state.mouse.y - this.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                if(dist < 100) {
                    this.x -= dx/20;
                    this.y -= dy/20;
                }

                if (this.y < 0) this.init();
            }
        }

        function setupCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < CONFIG.particleDensity; i++) {
                particles.push(new Particle());
            }
        }

        function runAnimation() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(runAnimation);
        }

        // --- محرك البيانات والمزامنة (Data & Sync Engine) ---

        async function initAlQuran() {
            try {
                // جلب قائمة السور
                const response = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await response.json();
                const dropdown = document.getElementById('surah-dropdown');
                
                data.data.forEach(surah => {
                    const option = document.createElement('option');
                    option.value = surah.number;
                    option.text = `${surah.number}. ${surah.name}`;
                    dropdown.appendChild(option);
                });

                // السورة الافتراضية (يس)
                dropdown.value = 36;
                changeSource();
            } catch (error) {
                console.error("خطأ في جلب بيانات السور");
            }
        }

        async function changeSource() {
            const surahNumber = document.getElementById('surah-dropdown').value;
            const reciterBase = document.getElementById('reciter-dropdown').value;
            const player = document.getElementById('audio-player');
            const content = document.getElementById('ayah-content');

            // 1. جلب نصوص الآيات
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/ar.quran-simple`);
            const data = await res.json();
            state.ayahs = data.data.ayahs;
            state.currentAyahIndex = -1;

            // 2. تحديث ملف الصوت
            const formattedNumber = surahNumber.padStart(3, '0');
            player.src = `${reciterBase}${formattedNumber}.mp3`;
            player.play().catch(e => console.log("في انتظار تفاعل المستخدم"));

            // 3. برمجة المزامنة الذكية
            player.ontimeupdate = () => {
                if(!player.duration) return;
                
                // خوارزمية تقسيم الوقت على عدد الآيات
                const progress = player.currentTime / player.duration;
                const index = Math.floor(progress * state.ayahs.length);

                if (index !== state.currentAyahIndex && state.ayahs[index]) {
                    state.currentAyahIndex = index;
                    
                    // تأثير التلاشي والانتقال
                    content.classList.remove('visible');
                    setTimeout(() => {
                        content.innerText = state.ayahs[index].text;
                        content.classList.add('visible');
                    }, 800);
                }
            };
        }

        // --- محركات التجميل (Utility Engines) ---

        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('time-digits').innerText = `${h}:${m}:${s}`;
        }

        function createFloatingText() {
            const container = document.getElementById('flying-container');
            const el = document.createElement('div');
            el.className = 'flying-scripture';
            el.innerText = CONFIG.phrases[Math.floor(Math.random() * CONFIG.phrases.length)];
            
            const startX = Math.random() * window.innerWidth;
            el.style.left = startX + "px";
            el.style.bottom = "-100px";
            el.style.transition = "transform 40s linear, opacity 5s ease";
            
            container.appendChild(el);

            requestAnimationFrame(() => {
                el.style.transform = `translateY(-${window.innerHeight + 200}px) rotate(${Math.random()*20}deg)`;
                el.style.opacity = "0.5";
            });

            setTimeout(() => el.remove(), 40000);
        }

        // --- إدارة الأحداث (Event Handlers) ---

        window.addEventListener('mousemove', (e) => {
            state.mouse.x = e.clientX;
            state.mouse.y = e.clientY;
            
            const cursor = document.getElementById('custom-cursor');
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        window.addEventListener('resize', setupCanvas);

        // تشغيل المحرك الإمبراطوري
        setupCanvas();
        runAnimation();
        initAlQuran();
        setInterval(updateClock, 1000);
        setInterval(createFloatingText, CONFIG.floatingInterval);

        // رسالة ترحيب في الكونسول
        console.log("%cمحراب النور العظيم تم التشغيل بنجاح", "color: #d4af37; font-size: 20px; font-weight: bold;");
    </script>
</body>
</html>







