<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <style>
        :root { --primary: #1a4d1a; --secondary: #2d5a27; --bg: #f4f7f4; }
        body { background: var(--bg); font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; padding: 20px; color: #2c3e50; }
        .container { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 600px; margin: auto; border-top: 8px solid var(--primary); }
        h1 { color: var(--primary); margin-bottom: 5px; }
        .motto { color: var(--secondary); font-weight: bold; margin-bottom: 25px; }
        
        .selection-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: right; margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--primary); }
        select { width: 100%; padding: 10px; border-radius: 10px; border: 2px solid #ddd; outline: none; }
        
        .main-card { background: #fff; border: 1px solid #eee; border-radius: 20px; padding: 20px; display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .btn { display: block; width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; font-weight: bold; cursor: pointer; border: none; text-decoration: none; font-size: 16px; }
        .btn-audio { background: #f0f9f0; border: 1px solid #1a4d1a; color: var(--primary); }
        .btn-read { background: var(--primary); color: white; }
        .btn-mic { background: #2c3e50; color: white; }
        .btn-stop { background: #e74c3c; color: white; }

        #status { margin-top: 15px; padding: 15px; border-radius: 10px; font-weight: bold; }
        .correct { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .wrong { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .quran-display { font-size: 22px; color: var(--primary); margin: 15px 0; padding: 15px; border-bottom: 2px dashed #eee; line-height: 1.6; }
        audio { width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ ğŸ“–</h1>
    <p class="motto">Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØªØ¯Ø¨Ø± ÙˆØªØµØ­ÙŠØ­ Ø¢Ù„ÙŠ</p>

    <div class="selection-grid">
        <div>
            <label>ğŸ™ï¸ Ø§Ù„Ù‚Ø§Ø±Ø¦:</label>
            <select id="reader" onchange="updateInterface()">
                <option value="yasser">ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ</option>
                <option value="s_gmd">Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</option>
                <option value="afs">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
                <option value="uaiq">Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ</option>
                <option value="basit">Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯</option>
            </select>
        </div>
        <div>
            <label>ğŸ“– Ø§Ù„Ø³ÙˆØ±Ø©:</label>
            <select id="surah" onchange="updateInterface()">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --</option>
            </select>
        </div>
    </div>

    <div id="mainArea" class="main-card">
        <h2 id="surahTitle"></h2>
        
        <div class="btn-audio">
            <p>ğŸ§ Ø§Ø³ØªÙ…Ø§Ø¹ Ø¨ØµÙˆØª Ø§Ù„Ø´ÙŠØ®:</p>
            <audio id="audioPlayer" controls><source src="" type="audio/mpeg"></audio>
        </div>

        <a id="tadaborLink" href="#" target="_blank" class="btn btn-read">ğŸ“– Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØªÙØ³ÙŠØ± Ø§Ù„Ø³ÙˆØ±Ø©</a>
        
        <div style="border-top: 2px solid #eee; margin-top: 20px; padding-top: 10px;">
            <p style="font-weight:bold;">ğŸ™ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ³Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ (Ø£ÙŠ Ø¢ÙŠØ©):</p>
            <div id="targetText" class="quran-display">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø¢ÙŠØªÙ‡Ø§ Ø§Ù„Ø£ÙˆÙ„Ù‰...</div>
            <button id="micBtn" class="btn btn-mic" onclick="startRecognition()">ğŸ™ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø¢Ù†</button>
            <div id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹...</div>
            <p id="userWords" style="font-size: 14px; color: #666;"></p>
        </div>
    </div>
</div>

<script>
    let currentAyahText = "";
    const surahSelect = document.getElementById('surah');
    const audioPlayer = document.getElementById('audioPlayer');

    // 1. ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± Ù…Ù† Ø§Ù„Ù€ API
    fetch('https://api.alquran.cloud/v1/surah')
        .then(res => res.json())
        .then(data => {
            data.data.forEach(s => {
                let opt = document.createElement('option');
                opt.value = s.number;
                opt.text = s.number + ". " + s.name;
                surahSelect.add(opt);
            });
        });

    // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    function updateInterface() {
        const sNum = surahSelect.value;
        const reader = document.getElementById('reader').value;
        if(!sNum) return;

        document.getElementById('mainArea').style.display = 'block';
        document.getElementById('surahTitle').innerText = "Ø³ÙˆØ±Ø© " + surahSelect.options[surahSelect.selectedIndex].text.split('. ')[1];
        document.getElementById('tadaborLink').href = "https://quran.ksu.edu.sa/index.php?l=ar#sr=" + sNum;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØª
        const servers = {
            'yasser': 'https://server11.mp3quran.net/yasser/',
            's_gmd': 'https://server7.mp3quran.net/s_gmd/',
            'afs': 'https://server8.mp3quran.net/afs/',
            'uaiq': 'https://server12.mp3quran.net/maher/',
            'basit': 'https://server7.mp3quran.net/basit/'
        };
        audioPlayer.src = servers[reader] + sNum.padStart(3, '0') + ".mp3";

        // ØªØ­Ù…ÙŠÙ„ Ù†Øµ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„ØªØµØ­ÙŠØ­
        fetch(`https://api.alquran.cloud/v1/ayah/${sNum}:1/ar.quran-simple`)
            .then(res => res.json())
            .then(data => {
                currentAyahText = data.data.text.replace(/[()]/g, "");
                document.getElementById('targetText').innerText = "Ø­Ø§ÙˆÙ„ Ù‚Ø±Ø§Ø¡Ø©: " + currentAyahText;
            });
    }

    // 3. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ù…ÙŠØ¹ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    function startRecognition() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'ar-SA';
        
        const btn = document.getElementById('micBtn');
        const status = document.getElementById('status');
        const userWords = document.getElementById('userWords');

        audioPlayer.pause();
        recognition.start();
        btn.innerText = "ğŸ›‘ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹.. Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¢Ù†";
        btn.className = "btn btn-stop";

        recognition.onresult = (event) => {
            const speech = event.results[0][0].transcript;
            userWords.innerText = "Ù‚Ù„Øª: " + speech;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†ØµÙˆØµ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‡Ù…Ø²Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª)
            const clean = (t) => t.replace(/[Ø£Ø¥Ø¢]/g, "Ø§").replace(/\s+/g, '').replace(/[Ø¤Ø¦]/g, "Ùˆ");
            
            if (clean(speech).includes(clean(currentAyahText)) || clean(currentAyahText).includes(clean(speech))) {
                status.innerText = "âœ… Ù‚Ø±Ø§Ø¡Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª";
                status.className = "correct";
            } else {
                status.innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ù…ÙŠØ¹.. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
                status.className = "wrong";
            }
            resetBtn();
        };

        recognition.onerror = () => { resetBtn(); status.innerText = "Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† (HTTPS Ù…Ø·Ù„ÙˆØ¨)"; };
        
        function resetBtn() {
            btn.innerText = "ğŸ™ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø¢Ù†";
            btn.className = "btn btn-mic";
        }
    }
</script>

</body>
</html>




